@using GigTracker.Entities;
@using Microsoft.AspNetCore.Http
@using GigTracker.Views.Home
@model HomeIndexViewModel
@inject Microsoft.AspNetCore.Http.IHttpContextAccessor HttpContextAccessor
@{
    Layout = "_Layout";
}

<!DOCTYPE html>

<html>
<body>
    <input asp-for="UserId" />
    <input asp-for="UserRole" />

    <!-- Navbar brand -->
    <nav class="navbar navbar-expand-md navbar-dark">
        @*<a class="navbar-brand" href="#">GigTracker</a>*@

        <!-- Collapse button -->
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#collapsibleNavbar">
            <span class="navbar-toggler-icon"></span>
        </button>

        <!-- Collapsible content -->
        <div class="collapse navbar-collapse" id="collapsibleNavbar">
            @*menu items that will appear on the left of the menu bar*@
            <ul class="navbar-nav mr-auto">
                @if (Model.UserRole == "Admin" || Model.UserRole == "User") {
                    <li class="nav-item active">
                        <a asp-controller="Gig" asp-action="List" class="btn btn-default menu-button">My Gigs</a>
                    </li>
                    <li class="nav-item">
                        <a asp-controller="User" asp-action="Details" asp-route-id=@Model.UserId class="btn btn-default menu-button">Profile</a>
                    </li>
                }
                @if (Model.UserRole == "Admin") {
                    <li class="nav-item">
                        <a asp-controller="User" asp-action="List" class="btn btn-default menu-button">Users</a>
                    </li>
                }
            </ul>
            @*menu items that will appear on the right of the menu bar*@
            <ul class="navbar-nav ml-auto">
                <li class="nav-item">
                    <input asp-for="ArtistSearch" name="searchArtist" id="searchArtist" class="form-control mr-auto" type="search" placeholder="Search for Artist" aria-label="Search for Artist">
                </li>
                <li class="nav-item active">
                    @if (Model.UserId.HasValue == false) {
                        <a asp-controller="Account" asp-action="Login" class="btn btn-default menu-button mr-auto">Login</a>
                    }
                    else {
                        <a asp-controller="Account" asp-action="Logout" class="btn btn-default menu-button mr-auto">Logout</a>
                        <span>User: @Model.User.FullName</span>
                    }
                </li>
            </ul>
        </div>
    </nav>

    <partial name="_GigList" for="Gigs" />

</body>
</html>

<script>
    $(document).ready(function () {
    });

    $('#searchArtist').on('keypress', function (e) {
        if (e.which === 13) {

            //Disable textbox to prevent multiple submit
            $(this).attr("disabled", "disabled");

            //Do Stuff, submit, etc..
            var artistquery = $(this).val();

            $.get("", { artistQuery: artistquery, newQuery: true }, function (result) {
                $("body").html(result);
            });

            //Enable the textbox again if needed.
            $(this).removeAttr("disabled");
        }
    });

</script>
